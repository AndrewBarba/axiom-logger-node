"use strict";var U=Object.create;var _=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var B=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),W=(t,e)=>{for(var r in e)_(t,r,{get:e[r],enumerable:!0})},C=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of G(e))!M.call(t,i)&&i!==r&&_(t,i,{get:()=>e[i],enumerable:!(n=z(e,i))||n.enumerable});return t};var k=(t,e,r)=>(r=t!=null?U(Q(t)):{},C(e||!t||!t.__esModule?_(r,"default",{value:t,enumerable:!0}):r,t)),F=t=>C(_({},"__esModule",{value:!0}),t);var D=B((le,j)=>{"use strict";function V(t){var e=new t,r=e;function n(){var s=e;return s.next?e=s.next:(e=new t,r=e),s.next=null,s}function i(s){r.next=s,r=s}return{get:n,release:i}}j.exports=V});var K=B((pe,A)=>{"use strict";var X=D();function $(t,e,r){if(typeof t=="function"&&(r=e,e=t,t=null),r<1)throw new Error("fastqueue concurrency must be greater than 1");var n=X(Y),i=null,s=null,l=0,g=null,a={push:q,drain:f,saturated:f,pause:c,paused:!1,concurrency:r,running:m,resume:v,idle:y,length:d,getQueue:h,unshift:S,empty:f,kill:N,killAndDrain:I,error:J};return a;function m(){return l}function c(){a.paused=!0}function d(){for(var u=i,p=0;u;)u=u.next,p++;return p}function h(){for(var u=i,p=[];u;)p.push(u.value),u=u.next;return p}function v(){if(!!a.paused){a.paused=!1;for(var u=0;u<a.concurrency;u++)l++,w()}}function y(){return l===0&&a.length()===0}function q(u,p){var o=n.get();o.context=t,o.release=w,o.value=u,o.callback=p||f,o.errorHandler=g,l===a.concurrency||a.paused?s?(s.next=o,s=o):(i=o,s=o,a.saturated()):(l++,e.call(t,o.value,o.worked))}function S(u,p){var o=n.get();o.context=t,o.release=w,o.value=u,o.callback=p||f,l===a.concurrency||a.paused?i?(o.next=i,i=o):(i=o,s=o,a.saturated()):(l++,e.call(t,o.value,o.worked))}function w(u){u&&n.release(u);var p=i;p?a.paused?l--:(s===i&&(s=null),i=p.next,p.next=null,e.call(t,p.value,p.worked),s===null&&a.empty()):--l===0&&a.drain()}function N(){i=null,s=null,a.drain=f}function I(){i=null,s=null,a.drain(),a.drain=f}function J(u){g=u}}function f(){}function Y(){this.value=null,this.callback=f,this.next=null,this.release=f,this.context=null,this.errorHandler=null;var t=this;this.worked=function(r,n){var i=t.callback,s=t.errorHandler,l=t.value;t.value=null,t.callback=f,t.errorHandler&&s(r,l),i.call(t.context,r,n),t.release(t)}}function Z(t,e,r){typeof t=="function"&&(r=e,e=t,t=null);function n(c,d){e.call(this,c).then(function(h){d(null,h)},d)}var i=$(t,n,r),s=i.push,l=i.unshift;return i.push=g,i.unshift=a,i.drained=m,i;function g(c){var d=new Promise(function(h,v){s(c,function(y,q){if(y){v(y);return}h(q)})});return d.catch(f),d}function a(c){var d=new Promise(function(h,v){l(c,function(y,q){if(y){v(y);return}h(q)})});return d.catch(f),d}function m(){var c=i.drain,d=new Promise(function(h){i.drain=function(){c(),h()}});return d}}A.exports=$;A.exports.promise=Z});var ee={};W(ee,{AxiomClient:()=>b,AxiomLogger:()=>O});module.exports=F(ee);var T=require("undici");function H(t){return t&&typeof t=="object"&&!Array.isArray(t)}function P(t,...e){if(!e.length)return t;let r=e.shift();if(H(t)&&H(r))for(let n in r)H(r[n])?(t[n]||Object.assign(t,{[n]:{}}),P(t[n],r[n])):Object.assign(t,{[n]:r[n]});return P(t,...e)}var E=k(require("querystring")),x=class{constructor(e){this._options=e??{}}get(e,r){return this.request(e,{...r,method:"GET"})}post(e,r){return this.request(e,{...r,method:"POST"})}put(e,r){return this.request(e,{...r,method:"PUT"})}patch(e,r){return this.request(e,{...r,method:"PATCH"})}delete(e,r){return this.request(e,{...r,method:"DELETE"})}options(e,r){return this.request(e,{...r,method:"OPTIONS"})}head(e,r){return this.request(e,{...r,method:"HEAD"})}async request(e,r){let n=P({},this._options,r),i=new URL(n.basePath?`${n.basePath}/${e}`:e);for(let[m,c]of Object.entries(n.searchParams??{}))typeof c=="string"&&i.searchParams.set(m,c);let s=n.method??"GET",l={...n.headers};if(n.jsonBody&&(l["content-type"]="application/json"),n.formBody&&(l["content-type"]="application/x-www-form-urlencoded"),n.username&&n.password){let m=Buffer.from(`${n.username}:${n.password}`).toString("base64");l.authorization=`Basic ${m}`}let g=n.jsonBody?JSON.stringify(n.jsonBody):n.formBody?E.stringify(n.formBody):n.body,a=await(0,T.request)(i,{method:s,headers:l,body:g,headersTimeout:n.firstByteTimeout??n.requestTimeout,bodyTimeout:n.requestTimeout,idempotent:n.idempotent,maxRedirections:n.maxRedirections});if(a.statusCode>=400)throw new R(i,n,a,await a.body.text());return a}},se=new x,R=class extends Error{constructor(r,n,i,s){super(`${n.method} ${r.href} - ${i.statusCode} ${s}`);this.statusCode=i.statusCode,this.headers=i.headers,this.body=s,this.request=n,this.response=i}toJSON(){return{statusCode:this.statusCode,headers:this.headers,body:this.body,stack:this.stack}}};var b=class{get apiKey(){return this._apiKey}get client(){return this._client}constructor(e){this._apiKey=e.apiKey,this._client=new x({basePath:"https://cloud.axiom.co/api",headers:{Authorization:`Bearer ${e.apiKey}`}})}ingest(e,r){return this.client.post(`v1/datasets/${e}/ingest`,{jsonBody:r})}};var L=k(K()),O=class{get client(){return this._client}get dataset(){return this._dataset}get defaultProperties(){return this._defaultProperties}set defaultProperties(e){this._defaultProperties=e}constructor(e){this._client="client"in e?e.client:new b({apiKey:e.apiKey}),this._dataset=e.dataset,this._defaultProperties=e.defaultProperties,this._q=L.promise(r=>this._write(r),1)}write(e){let r=Array.isArray(e)?e:[e];this._q.push(r.map(n=>({...this._defaultProperties,...n,_time:Date.now()})))}async drain(){if(!this._q.idle())return this._q.drained()}async _write(e){await this._client.ingest(this._dataset,e)}};0&&(module.exports={AxiomClient,AxiomLogger});
